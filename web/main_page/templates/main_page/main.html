{% extends "main_page/base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'main_page/css/main.css' %}">
{% endblock %}

{% block body %}
{% include "main_page/base.html" %}
    <div class="record-container">
        <h2 class="record-title">üìå –í—Å–µ –∑–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
        
        <!-- –û–±—â–∞—è —Å—É–º–º–∞ –í–ù–ï —Ü–∏–∫–ª–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑) -->
        {% if total_sum > 0 %}
        <div class="total-summary">
            <h3>üí∞ –û–±—â–∞—è —Å—É–º–º–∞ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π: {{ total_sum|floatformat:2 }} —Ä—É–±.</h3>
        </div>
        {% endif %}

        {% if records %}
            {% for record in records %}
                <div class="record-card">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ -->
                    <div class="record-section">
                        <h3 class="section-title">üë§ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h3>
                        <ul class="info-list">
                            <li><strong>–ò–º—è:</strong> {{ record.name.name }}</li>
                            <li><strong>–§–∞–º–∏–ª–∏—è:</strong> {{ record.name.surname }}</li>
                            <li><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ record.name.phone }}</li>
                            <li><strong>Email:</strong> {{ record.name.email }}</li>
                        </ul>
                    </div>

                    <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ -->
                    <div class="record-section">
                        <h3 class="section-title">üõç –í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏</h3>
                        <ul class="services-list">
                            {% for item in record.basket_history %}
                                <li>{{ item.service }} ‚Äî {{ item.quantity }} —à—Ç. ({{ item.price|floatformat:2 }} —Ä—É–±.)</li>
                            {% empty %}
                                <li>–ù–µ—Ç —É—Å–ª—É–≥.</li>
                            {% endfor %}
                        </ul>
                        <!-- –°—É–º–º–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–ø–∏—Å–∏ -->
                        <div class="record-sum">
                            <strong>–°—É–º–º–∞ –∑–∞–ø–∏—Å–∏:</strong> {{ record.get_record_sum|floatformat:2 }} —Ä—É–±.
                        </div>
                    </div>

                    <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ -->
                    <div class="record-section">
                        <h3 class="section-title">üïí –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏</h3>
                        <p><strong>–î–∞—Ç–∞:</strong> {{ record.time_history.selected_date }}</p>
                        <p><strong>–í—Ä–µ–º—è:</strong> {{ record.time_history.selected_time_slot }}</p>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                    <div class="record-actions">
                        <form action="{% url 'main:delete_record' record.pk %}" method="post" class="delete-form">
                            {% csrf_token %}
                            <button type="submit" class="delete-btn">‚ùå –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="no-records">‚ùå –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤.</p>
        {% endif %}
    </div>
{% endblock %}